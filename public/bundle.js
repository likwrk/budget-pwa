var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t,e){t.appendChild(e)}function a(t,e,n){t.insertBefore(e,n||null)}function u(t){t.parentNode.removeChild(t)}function c(t){return document.createElement(t)}function p(t){return document.createTextNode(t)}function d(){return p(" ")}function l(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function m(t,e){e=""+e,t.data!==e&&(t.data=e)}let y;function f(t){y=t}const h=[],g=Promise.resolve();let $=!1;const b=[],w=[],v=[];function D(t){w.push(t)}function x(){const t=new Set;do{for(;h.length;){const t=h.shift();f(t),S(t.$$)}for(;b.length;)b.shift()();for(;w.length;){const e=w.pop();t.has(e)||(e(),t.add(e))}}while(h.length);for(;v.length;)v.pop()();$=!1}function S(t){t.fragment&&(t.update(t.dirty),o(t.before_render),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_render.forEach(D))}let O;function N(){O={remaining:0,callbacks:[]}}function I(){O.remaining||o(O.callbacks)}function T(t){O.callbacks.push(t)}function _(t,n,s){const{fragment:i,on_mount:a,on_destroy:u,after_render:c}=t.$$;i.m(n,s),D(()=>{const n=a.map(e).filter(r);u?u.push(...n):o(n),t.$$.on_mount=[]}),c.forEach(D)}function C(t,e){t.$$.dirty||(h.push(t),$||($=!0,g.then(x)),t.$$.dirty=n()),t.$$.dirty[e]=!0}function H(e,r,s,i,a,u){const c=y;f(e);const p=r.props||{},d=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(c?c.$$.context:[]),callbacks:n(),dirty:null};let l=!1;d.ctx=s?s(e,p,(t,n)=>{d.ctx&&a(d.ctx[t],d.ctx[t]=n)&&(d.bound[t]&&d.bound[t](n),l&&C(e,t))}):p,d.update(),l=!0,o(d.before_render),d.fragment=i(d.ctx),r.target&&(r.hydrate?d.fragment.l(function(t){return Array.from(t.childNodes)}(r.target)):d.fragment.c(),r.intro&&e.$$.fragment.i&&e.$$.fragment.i(),_(e,r.target,r.anchor),x()),f(c)}class k{$destroy(){var e,n;n=!0,(e=this).$$&&(o(e.$$.on_destroy),e.$$.fragment.d(n),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={}),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function B(t){const e=t.getUTCFullYear(),n=t.getUTCMonth()+1,o=t.getUTCDate();return`${e}-${n<10?"0"+n:n}-${o<10?"0"+o:o}`}function P(t){return`${B(t)} ${function(t){const e=t.getUTCHours()+1,n=t.getUTCDate();return`${e<10?"0"+e:e}:${n<10?"0"+n:n}`}(t)}`}function A(e){var n,o,r,s,p,m,y,f,h,g,$;return{c(){n=c("form"),(o=c("label")).textContent="Date to:",r=d(),s=c("input"),p=d(),(m=c("label")).textContent="Budget:",y=d(),f=c("input"),g=d(),($=c("button")).textContent="Save",o.htmlFor="end",l(s,"type","date"),s.min=e.minDate,s.value=e.dateString,s.id="end",s.required=!0,m.htmlFor="budget",l(f,"type","number"),f.value=h=e.options.budget,f.id="budget",f.required=!0,n.dataset.action="save-options"},m(t,e){a(t,n,e),i(n,o),i(n,r),i(n,s),i(n,p),i(n,m),i(n,y),i(n,f),i(n,g),i(n,$)},p(t,e){t.minDate&&(s.min=e.minDate),t.dateString&&(s.value=e.dateString),t.options&&h!==(h=e.options.budget)&&(f.value=h)},i:t,o:t,d(t){t&&u(n)}}}function F(t,e,n){let{options:o}=e,r="",s="";return t.$set=t=>{"options"in t&&n("options",o=t.options)},t.$$.update=(t={options:1})=>{t.options&&(n("dateString",r=B(new Date(o.end))),n("minDate",s=B(new Date)))},{options:o,dateString:r,minDate:s}}class M extends k{constructor(t){super(),H(this,t,F,A,s,["options"])}}function E(t,e,n){const o=Object.create(t);return o.item=e[n],o}function J(t){var e,n,o,r,s,l,y,f,h,g,$,b=P(new Date(t.item.timestamp)),w=t.item.sum,v=t.item.category;return{c(){e=c("li"),n=p(b),o=d(),r=p(w),s=d(),l=p(v),y=d(),f=c("button"),h=p("Remove"),$=d(),f.type="button",f.dataset.action="remove-item",f.dataset.timestamp=g=t.item.timestamp},m(t,u){a(t,e,u),i(e,n),i(e,o),i(e,r),i(e,s),i(e,l),i(e,y),i(e,f),i(f,h),i(e,$)},p(t,e){t.historyItems&&b!==(b=P(new Date(e.item.timestamp)))&&m(n,b),t.historyItems&&w!==(w=e.item.sum)&&m(r,w),t.historyItems&&v!==(v=e.item.category)&&m(l,v),t.historyItems&&g!==(g=e.item.timestamp)&&(f.dataset.timestamp=g)},d(t){t&&u(e)}}}function U(e){for(var n,o=e.historyItems,r=[],s=0;s<o.length;s+=1)r[s]=J(E(e,o,s));return{c(){n=c("ul");for(var t=0;t<r.length;t+=1)r[t].c()},m(t,e){a(t,n,e);for(var o=0;o<r.length;o+=1)r[o].m(n,null)},p(t,e){if(t.historyItems||t.formatDateTime){o=e.historyItems;for(var s=0;s<o.length;s+=1){const i=E(e,o,s);r[s]?r[s].p(t,i):(r[s]=J(i),r[s].c(),r[s].m(n,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=o.length}},i:t,o:t,d(t){t&&u(n),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(r,t)}}}function j(t,e,n){let o,{history:r}=e;return t.$set=t=>{"history"in t&&n("history",r=t.history)},t.$$.update=(t={history:1})=>{t.history&&n("historyItems",o=r.reverse())},{history:r,historyItems:o}}class q extends k{constructor(t){super(),H(this,t,j,U,s,["history"])}}function L(e){var n;return{c(){(n=c("form")).innerHTML='<input placeholder="Sum" name="sum" type="number" value="" required class="svelte-h5p8ml">\n\t\t\t  <input placeholder="Category" name="category" type="text" value="" class="svelte-h5p8ml">\n\t\t\t  <button class="svelte-h5p8ml">Add</button>',n.dataset.action="add-item"},m(t,e){a(t,n,e)},p:t,i:t,o:t,d(t){t&&u(n)}}}class R extends k{constructor(t){super(),H(this,t,null,L,s,[])}}function Y(t){var e,n=new M({props:{options:t.options}});return{c(){n.$$.fragment.c()},m(t,o){_(n,t,o),e=!0},p(t,e){var o={};t.options&&(o.options=e.options),n.$set(o)},i(t){e||(n.$$.fragment.i(t),e=!0)},o(t){n.$$.fragment.o(t),e=!1},d(t){n.$destroy(t)}}}function z(t){var e,n=new q({props:{history:t.history}});return{c(){n.$$.fragment.c()},m(t,o){_(n,t,o),e=!0},p(t,e){var o={};t.history&&(o.history=e.history),n.$set(o)},i(t){e||(n.$$.fragment.i(t),e=!0)},o(t){n.$$.fragment.o(t),e=!1},d(t){n.$destroy(t)}}}function G(t){var e,n,o,r,s,l,y,f,h,g,$,b,w,v,D,x,S,O,C,H,k=new R({}),B=t.showOptions&&Y(t),P=t.showHistory&&z(t);return{c(){e=c("main"),n=c("p"),o=p("Per day: "),r=p(t.perDay),s=d(),l=c("p"),y=p("Spent: "),f=p(t.spent),h=d(),g=c("p"),$=p("Budget for today: "),b=p(t.todayBudget),w=d(),k.$$.fragment.c(),v=d(),(D=c("button")).textContent="Options",x=d(),(S=c("button")).textContent="History",O=d(),B&&B.c(),C=d(),P&&P.c(),D.type="button",D.dataset.action="toggle-options",S.type="button",S.dataset.action="toggle-history",e.className="svelte-1j39u3t"},m(t,u){a(t,e,u),i(e,n),i(n,o),i(n,r),i(e,s),i(e,l),i(l,y),i(l,f),i(e,h),i(e,g),i(g,$),i(g,b),i(e,w),_(k,e,null),i(e,v),i(e,D),i(e,x),i(e,S),i(e,O),B&&B.m(e,null),i(e,C),P&&P.m(e,null),H=!0},p(t,n){H&&!t.perDay||m(r,n.perDay),H&&!t.spent||m(f,n.spent),H&&!t.todayBudget||m(b,n.todayBudget),n.showOptions?B?(B.p(t,n),B.i(1)):((B=Y(n)).c(),B.i(1),B.m(e,C)):B&&(N(),T(()=>{B.d(1),B=null}),B.o(1),I()),n.showHistory?P?(P.p(t,n),P.i(1)):((P=z(n)).c(),P.i(1),P.m(e,null)):P&&(N(),T(()=>{P.d(1),P=null}),P.o(1),I())},i(t){H||(k.$$.fragment.i(t),B&&B.i(),P&&P.i(),H=!0)},o(t){k.$$.fragment.o(t),B&&B.o(),P&&P.o(),H=!1},d(t){t&&u(e),k.$destroy(),B&&B.d(),P&&P.d()}}}function K(t,e,n){let o,r,s,i,a,u,{options:c,history:p,showOptions:d,showHistory:l}=e;return t.$set=t=>{"options"in t&&n("options",c=t.options),"history"in t&&n("history",p=t.history),"showOptions"in t&&n("showOptions",d=t.showOptions),"showHistory"in t&&n("showHistory",l=t.showHistory)},t.$$.update=(t={options:1,days:1,history:1,spentDays:1,perDay:1,spent:1,maxSpentForToday:1})=>{t.options&&n("days",o=Math.floor((c.end-c.start)/864e5)),t.options&&n("spentDays",r=Math.floor((Date.now()-c.start)/864e5)),(t.options||t.days)&&n("perDay",s=Math.round(c.budget/o)),t.history&&n("spent",i=p.reduce((t,e)=>t+e.sum,0)),(t.spentDays||t.perDay)&&n("maxSpentForToday",a=r*s),(t.perDay||t.spent||t.maxSpentForToday)&&n("todayBudget",u=s-(i-a))},{options:c,history:p,showOptions:d,showHistory:l,perDay:s,spent:i,todayBudget:u}}const Q="a3ebe359-db8c-4e82-b340-99d5ff6c0995",V=`history-${Q}`,W=`options-${Q}`;function X(){return{budget:0,end:Date.now(),start:Date.now(),active:!1}}function Z(t){return new Promise(e=>{localStorage.setItem(W,JSON.stringify(t)),e(t)})}function tt(){return new Promise(t=>{let e;try{e=JSON.parse(localStorage.getItem(V))||[]}catch(t){e=[]}t(e)})}let et=!1,nt=!1;const ot=new class extends k{constructor(t){super(),H(this,t,K,G,s,["options","history","showOptions","showHistory"])}}({target:document.body,props:{history:[],options:X(),showOptions:et,showHistory:nt}});return document.body.addEventListener("click",t=>{if("BUTTON"!==t.target.nodeName)return;const e=t.target.getAttribute("data-action");if(e)switch(e){case"remove-item":!async function(t){const e=Number(t.getAttribute("data-timestamp"));if(isNaN(e))return;const n=await function(t){return tt().then(e=>{const n=e.filter(e=>e.timestamp!==t);return localStorage.setItem(V,JSON.stringify(n)),n})}(e);ot.$set({history:n})}(t.target);break;case"toggle-options":et=!et,ot.$set({showOptions:et});break;case"toggle-history":nt=!nt,ot.$set({showHistory:nt})}}),document.body.addEventListener("submit",t=>{if("FORM"!==t.target.nodeName)return;const e=t.target.getAttribute("data-action");if(e)switch(t.preventDefault(),e){case"save-options":!async function(t){const e=new Date(t.end.value).getTime(),n=Date.now()<e,o=Number(t.budget.value),[r,s]=await Promise.all([Z({end:e,active:n,budget:o,start:Date.now()}),new Promise(t=>{localStorage.setItem(V,JSON.stringify([])),t([])})]);et=!1,ot.$set({options:r,history:s,showOptions:et})}(t.target);break;case"add-item":!async function(t){const e=Number(t.sum.value),n=t.category.value||"",o=await(r={sum:e,category:n,timestamp:Date.now()},tt().then(t=>(t.push(r),localStorage.setItem(V,JSON.stringify(t)),t)));var r;t.reset(),ot.$set({history:o})}(t.target)}}),async function(){const[t,e]=await Promise.all([new Promise(t=>{let e;try{e=JSON.parse(localStorage.getItem(W))||X()}catch(t){e=X()}t(e)}),tt()]);ot.$set({options:t,history:e})}(),ot}();
//# sourceMappingURL=bundle.js.map
